<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />

    <script type="text/javascript"
      src="http://static.robotwebtools.org/EventEmitter2/current/eventemitter2.min.js">
    </script>
    <script type="text/javascript" 
      src="http://static.robotwebtools.org/roslibjs/current/roslib.min.js">
    </script>
    <script 
      src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js">
    </script>

    <script type="text/javascript"
      src="/js/roslib.min.js">
    </script>

    <script type="text/javascript" type="text/javascript">

      window.onload = function(){

        var ctx = document.getElementById("line-chart");
        var lineChart = new  Chart(ctx, {
          type: 'line',
          data: {
            labels: ["","","","","","","","","","","","","","","","","","","",""],
            datasets: [{
              data: [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            }]
          },
          options: {
            responsive: true,
            title: {
              display: true,
              text: "CPU Temperature",
            },
            legend: {
              display: false
            },
            scales: {
              yAxes: [{
                ticks: {
                  begitAtZero: false,
                }
              }]
            }
          }
        });

      var ros = new ROSLIB.Ros();

      ros.on('connection', function() {
        console.log('Connected to web socket');
        document.getElementById('connecting').style.display = 'none';
        document.getElementById('error').style.display = 'none';
        document.getElementById('closed').style.display = 'none';
        document.getElementById('connected').style.display = 'inline';
          });

      ros.on('error', function(error) {
        console.log(error);
        document.getElementById('connecting').style.display = 'none';
        document.getElementById('error').style.display = 'inline';
        document.getElementById('closed').style.display = 'none';
        document.getElementById('connected').style.display = 'none';
          });

      ros.on('close', function() {
        console.log('Connection closed');
        document.getElementById('connecting').style.display = 'none';
        document.getElementById('error').style.display = 'none';
        document.getElementById('closed').style.display = 'inline';
        document.getElementById('connected').style.display = 'none';
          });

      ros.connect('ws://' + location.host + ':9090');

      var temp = new ROSLIB.Topic({
        ros : ros,
        name : 'pi/core/cpu_temp',
        messageType : 'std_msgs/Float32'
      });

      temp.subscribe(function(message){
        document.getElementById('cpu_temp').innerHTML = message.data;
        lineChart.data.datasets[0].data.push(message.data);
        lineChart.data.datasets[0].data.shift();
        lineChart.update();
      });

      };


    </script>
  </head>

  <body>
      <h1>Simple ROS User Interface</h1>
      <p>Connection Status :</p>
      <div id="statusIndicator">
        <p id="connecting">
          Connecting to rosbridge...
        </p>
        <p id="connected" style="color:#00D600; display:none">
          Connected
        </p>
        <p id="error" style="color:#FF0000; display:none">
          Error
        </p>
        <p id="closed" style="display:none">
          Connection closed.
        </p>
      </div>
      <canvas id="line-chart" width="800" height="450"></canvas>
      <p>CPU Temp : <span id=cpu_temp>-</span></p>
  </body>
</html>
